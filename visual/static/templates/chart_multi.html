{{#*inline "page"}}
<h2><p>{{title}}</p></h2>
<!--<style>-->
<!--    table {-->
<!--        font-family: arial, sans-serif;-->
<!--        border-collapse: collapse;-->
<!--        width: 100%;-->
<!--    }-->

<!--    td, th {-->
<!--        border: 1px solid #dddddd;analysis.html-->
<!--        text-align: left;-->
<!--        padding: 8px;-->
<!--    }-->

<!--    tr:nth-child(even) {-->
<!--        background-color: #dddddd;-->
<!--    }-->
<!--</style>-->

<div><canvas id="chart_0"></canvas><br></div>
<script src="/js/chart.js"></script>
<script src="/js/chartjs-adapter-date-fns.js"></script>


<script>

    const c = '{{data_vec}}';
    let json = JSON.parse(c.replace(/&quot;/g, '\"'));
    console.log("json: " + json);
    console.log("j[0] label: " + json[0].label);
    // const rust_datasets = [];
    let data_map = new Map();

    for (let i in json){
        console.log("label(" + i + "): " + json[i].label);
        const data_i = json[i].data;
        for(let j in data_i){
            console.log("data: " + data_i[j].x + ": " + data_i[j].y);
        }

        let s = {
            label: json[i].label,
            data: json[i].data
        };

        // TODO: UI filter: only show BTC for now (even though there's data for more)
        if(!s.label.startsWith("eth")){
            // rust_datasets.push(s);
            data_map.set(json[i].label, s);
        }
    }

    // ***** dataset format test ****
    console.log("datasets count: " + data_map.length);

    // var s1 = {
    //     label: 's1',
    //     borderColor: 'blue',
    //     data: [
    //         { x: '2017-01-06 18:39:30', y: 100 },
    //         { x: '2017-01-07 18:39:28', y: 101 },
    //     ]
    // };
    //
    // var s2 = {
    //     label: 's2',
    //     borderColor: 'red',
    //     data: [
    //         { x: '2017-01-07 18:00:00', y: 90 },
    //         { x: '2017-01-08 18:00:00', y: 105 },
    //     ]
    // };


    /*

    [{"label":"btc_usd","data":[{"x":"2023-12-27T04:39:23.828896Z","y":42330.03},{"x":"2023-12-27T04:39:23.112660Z","y":42330.02},{"x":"2023-12-27T04:39:21.940593Z","y":42330.03},{"x":"2023-12-27T04:39:20.877366Z","y":42330.02},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02},{"x":"2023-12-27T04:39:13.930413Z","y":42330.03}]},{"label":"btc_usd_MovingAvg0004","data":[{"x":"2023-12-27T04:39:23.828896Z","y":42330.024999999994},{"x":"2023-12-27T04:39:23.112660Z","y":42330.02333333332},{"x":"2023-12-27T04:39:21.940593Z","y":42330.024999999994},{"x":"2023-12-27T04:39:20.877366Z","y":42330.02},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02},{"x":"2023-12-27T04:39:17.479979Z","y":42330.024999999994},{"x":"2023-12-27T04:39:13.930413Z","y":42330.03}]},{"label":"btc_usd_MovingAvg0010","data":[{"x":"2023-12-27T04:39:23.828896Z","y":42330.02285714285},{"x":"2023-12-27T04:39:23.112660Z","y":42330.02166666666},{"x":"2023-12-27T04:39:21.940593Z","y":42330.02333333332},{"x":"2023-12-27T04:39:20.877366Z","y":42330.022},{"x":"2023-12-27T04:39:17.479979Z","y":42330.0225},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02333333333},{"x":"2023-12-27T04:39:17.479979Z","y":42330.024999999994},{"x":"2023-12-27T04:39:13.930413Z","y":42330.03}]},{"label":"btc_usd_MovingAvg0100","data":[{"x":"2023-12-27T04:39:23.828896Z","y":42330.02374999999},{"x":"2023-12-27T04:39:23.112660Z","y":42330.022857142845},{"x":"2023-12-27T04:39:21.940593Z","y":42330.02333333332},{"x":"2023-12-27T04:39:20.877366Z","y":42330.022},{"x":"2023-12-27T04:39:17.479979Z","y":42330.0225},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02333333333},{"x":"2023-12-27T04:39:17.479979Z","y":42330.024999999994},{"x":"2023-12-27T04:39:13.930413Z","y":42330.03}]},{"label":"btc_usd_MovingAvg1000","data":[{"x":"2023-12-27T04:39:23.828896Z","y":42330.02374999999},{"x":"2023-12-27T04:39:23.112660Z","y":42330.022857142845},{"x":"2023-12-27T04:39:21.940593Z","y":42330.02333333332},{"x":"2023-12-27T04:39:20.877366Z","y":42330.022},{"x":"2023-12-27T04:39:17.479979Z","y":42330.0225},{"x":"2023-12-27T04:39:17.479979Z","y":42330.02333333333},{"x":"2023-12-27T04:39:17.479979Z","y":42330.024999999994},{"x":"2023-12-27T04:39:13.930413Z","y":42330.03}]}]



     */
    let test_string = JSON.stringify(Array.from(data_map.values()));
    console.log("[test_string] " + test_string);

    let ctx = document.getElementById('chart_0').getContext('2d');
    let chart_title = '{{chart_title}}';
    let chart = new Chart(ctx, {
        type: 'line',
        // data: { datasets: [s1, s2] },
        data: { datasets: Array.from(data_map.values()) },
        options: {
            animation: {
                duration: 0
            },
            responsive: true,   // resize to fit browser window
            interaction: {
                mode: 'index',
                intersect: false,
            },
            stacked: false,
            plugins: {
                title: {
                    display: true,
                    text: chart_title
                }
            },
            scales: {
                x: {
                    type: 'time'
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                },
            }
        }
    });

</script>

<br>

{{/inline}}
{{> (lookup this "parent")}}